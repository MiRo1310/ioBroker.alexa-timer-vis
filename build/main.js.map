{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["'use strict';\nimport * as utils from '@iobroker/adapter-core';\nimport { decomposeInputValue } from '@/app/decompose-input-value';\nimport { errorLogger } from '@/lib/logging';\nimport { resetAllTimerValuesAndStateValues } from '@/app/reset';\nimport { timerAdd } from '@/app/timer-add';\nimport { timerObject } from '@/config/timer-data';\nimport { Timer } from '@/app/timer';\nimport store from '@/store/store';\nimport type { TimerCondition } from '@/types/types';\nimport { timerDelete } from '@/app/timer-delete';\nimport { extendOrShortTimer } from '@/app/timer-extend-or-shorten';\nimport { writeStates } from '@/app/write-state';\nimport { isIobrokerValue } from '@/lib/state';\nimport {\n    isAlexaSummaryStateChanged,\n    isAlexaTimerVisResetButton,\n    isTimerAction,\n    setAdapterStatusAndInitStateCreation,\n} from '@/app/ioBrokerStateAndObjects';\nimport { VoiceInput } from '@/app/voiceInput';\n\nlet timeout_1: ioBroker.Timeout | undefined;\nlet debounceTimeout: ioBroker.Timeout | undefined;\nlet voiceInput: VoiceInput;\n\nexport default class AlexaTimerVis extends utils.Adapter {\n    private static instance: AlexaTimerVis;\n\n    /**\n     * @param [options] - See {@link\n     */\n    public constructor(options: Partial<utils.AdapterOptions> = {}) {\n        super({\n            ...options,\n            name: 'alexa-timer-vis',\n        });\n        this.on('ready', this.onReady.bind(this));\n        this.on('unload', this.onUnload.bind(this));\n        AlexaTimerVis.instance = this;\n    }\n\n    private async onReady(): Promise<void> {\n        if (this.adapterConfig && '_id' in this.adapterConfig) {\n            store.init({\n                adapter: this,\n                alexaTimerVisInstance: this.adapterConfig?._id.replace('system.adapter.', ''),\n                ...this.config,\n            });\n        } else {\n            return;\n        }\n\n        try {\n            const test = '((3 sss+ 2 * 5)';\n            eval(test);\n        } catch (e) {\n            errorLogger('Error in onReady', e, null);\n        }\n\n        await this.setState('info.connection', false, true);\n        timerObject.timer.timer1 = new Timer({ store });\n        timerObject.timer.timer2 = new Timer({ store });\n        timerObject.timer.timer3 = new Timer({ store });\n        timerObject.timer.timer4 = new Timer({ store });\n\n        await setAdapterStatusAndInitStateCreation();\n        await resetAllTimerValuesAndStateValues();\n\n        this.on('stateChange', async (id, state) => {\n            try {\n                if (isAlexaSummaryStateChanged({ state: state, id: id }) && isTimerAction(state)) {\n                    this.log.debug('Alexa state changed');\n                    if (isIobrokerValue(state)) {\n                        store.timerAction = state.val as TimerCondition;\n                    }\n\n                    const res = await this.getForeignStateAsync(store.pathAlexaSummary);\n                    if (isIobrokerValue(res)) {\n                        voiceInput = new VoiceInput(res.val);\n                        this.log.debug(`VoiceInput: ${voiceInput.get()}`);\n                    }\n\n                    const abortWord = voiceInput.getAbortWord();\n                    if (abortWord) {\n                        this.log.debug(`This will be aborted because found \"${abortWord}\" in the voice input.`);\n                        return;\n                    }\n\n                    if (voiceInput.isAbortSentence() && !store.isDeleteTimer()) {\n                        this.log.debug('Input is an abort sentence. No action will be executed.');\n                        return;\n                    }\n\n                    const { name, timerSec, deleteVal } = decomposeInputValue(voiceInput);\n                    voiceInput.doesAlexaSendAQuestion();\n\n                    if (store.isDeleteTimer()) {\n                        await timerDelete(name, timerSec, voiceInput, deleteVal);\n                        return;\n                    }\n                    if (store.isAddTimer()) {\n                        await timerAdd(name, timerSec);\n                        return;\n                    }\n                    if (store.isExtendTimer() || store.isShortenTimer()) {\n                        await extendOrShortTimer({ voiceInput, name });\n                        return;\n                    }\n\n                    return;\n                }\n                if (isAlexaTimerVisResetButton(state, id)) {\n                    const timerIndex = id.split('.')[2];\n                    const timer = timerObject.timer[timerIndex];\n                    await timer.stopTimerInAlexa();\n                }\n            } catch (e) {\n                errorLogger('Error in stateChange', e, voiceInput);\n            }\n        });\n\n        this.subscribeForeignStates(store.pathAlexaStateToListenTo);\n    }\n\n    async onUnload(callback: () => void): Promise<void> {\n        try {\n            this.log.info('Adapter shuts down');\n\n            await writeStates({ reset: true });\n\n            this.clearTimeout(timeout_1);\n            this.clearTimeout(debounceTimeout);\n\n            this.clearInterval(store.interval);\n\n            for (const element in timerObject.interval) {\n                this.clearInterval(timerObject.interval[element as keyof typeof timerObject.interval]);\n            }\n\n            this.log.debug('Intervals and timeouts cleared!');\n\n            callback();\n        } catch (e) {\n            errorLogger('Error in onUnload', e, voiceInput);\n            callback();\n        }\n    }\n}\n\nlet adapter;\nif (require.main !== module) {\n    adapter = (options: Partial<utils.AdapterOptions> | undefined): AlexaTimerVis => new AlexaTimerVis(options);\n} else {\n    (() => new AlexaTimerVis())();\n}\nexport { adapter };\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,YAAuB;AACvB,mCAAoC;AACpC,qBAA4B;AAC5B,mBAAkD;AAClD,uBAAyB;AACzB,wBAA4B;AAC5B,mBAAsB;AACtB,mBAAkB;AAElB,0BAA4B;AAC5B,qCAAmC;AACnC,yBAA4B;AAC5B,mBAAgC;AAChC,qCAKO;AACP,wBAA2B;AAE3B,IAAI;AACJ,IAAI;AACJ,IAAI;AAEJ,MAAO,sBAAoC,MAAM,QAAQ;AAAA,EACrD,OAAe;AAAA;AAAA;AAAA;AAAA,EAKR,YAAY,UAAyC,CAAC,GAAG;AAC5D,UAAM;AAAA,MACF,GAAG;AAAA,MACH,MAAM;AAAA,IACV,CAAC;AACD,SAAK,GAAG,SAAS,KAAK,QAAQ,KAAK,IAAI,CAAC;AACxC,SAAK,GAAG,UAAU,KAAK,SAAS,KAAK,IAAI,CAAC;AAC1C,kBAAc,WAAW;AAAA,EAC7B;AAAA,EAEA,MAAc,UAAyB;AA1C3C;AA2CQ,QAAI,KAAK,iBAAiB,SAAS,KAAK,eAAe;AACnD,mBAAAA,QAAM,KAAK;AAAA,QACP,SAAS;AAAA,QACT,wBAAuB,UAAK,kBAAL,mBAAoB,IAAI,QAAQ,mBAAmB;AAAA,QAC1E,GAAG,KAAK;AAAA,MACZ,CAAC;AAAA,IACL,OAAO;AACH;AAAA,IACJ;AAEA,QAAI;AACA,YAAM,OAAO;AACb,WAAK,IAAI;AAAA,IACb,SAAS,GAAG;AACR,sCAAY,oBAAoB,GAAG,IAAI;AAAA,IAC3C;AAEA,UAAM,KAAK,SAAS,mBAAmB,OAAO,IAAI;AAClD,kCAAY,MAAM,SAAS,IAAI,mBAAM,EAAE,oBAAAA,QAAM,CAAC;AAC9C,kCAAY,MAAM,SAAS,IAAI,mBAAM,EAAE,oBAAAA,QAAM,CAAC;AAC9C,kCAAY,MAAM,SAAS,IAAI,mBAAM,EAAE,oBAAAA,QAAM,CAAC;AAC9C,kCAAY,MAAM,SAAS,IAAI,mBAAM,EAAE,oBAAAA,QAAM,CAAC;AAE9C,cAAM,qEAAqC;AAC3C,cAAM,gDAAkC;AAExC,SAAK,GAAG,eAAe,OAAO,IAAI,UAAU;AACxC,UAAI;AACA,gBAAI,2DAA2B,EAAE,OAAc,GAAO,CAAC,SAAK,8CAAc,KAAK,GAAG;AAC9E,eAAK,IAAI,MAAM,qBAAqB;AACpC,kBAAI,8BAAgB,KAAK,GAAG;AACxB,yBAAAA,QAAM,cAAc,MAAM;AAAA,UAC9B;AAEA,gBAAM,MAAM,MAAM,KAAK,qBAAqB,aAAAA,QAAM,gBAAgB;AAClE,kBAAI,8BAAgB,GAAG,GAAG;AACtB,yBAAa,IAAI,6BAAW,IAAI,GAAG;AACnC,iBAAK,IAAI,MAAM,eAAe,WAAW,IAAI,CAAC,EAAE;AAAA,UACpD;AAEA,gBAAM,YAAY,WAAW,aAAa;AAC1C,cAAI,WAAW;AACX,iBAAK,IAAI,MAAM,uCAAuC,SAAS,uBAAuB;AACtF;AAAA,UACJ;AAEA,cAAI,WAAW,gBAAgB,KAAK,CAAC,aAAAA,QAAM,cAAc,GAAG;AACxD,iBAAK,IAAI,MAAM,yDAAyD;AACxE;AAAA,UACJ;AAEA,gBAAM,EAAE,MAAM,UAAU,UAAU,QAAI,kDAAoB,UAAU;AACpE,qBAAW,uBAAuB;AAElC,cAAI,aAAAA,QAAM,cAAc,GAAG;AACvB,sBAAM,iCAAY,MAAM,UAAU,YAAY,SAAS;AACvD;AAAA,UACJ;AACA,cAAI,aAAAA,QAAM,WAAW,GAAG;AACpB,sBAAM,2BAAS,MAAM,QAAQ;AAC7B;AAAA,UACJ;AACA,cAAI,aAAAA,QAAM,cAAc,KAAK,aAAAA,QAAM,eAAe,GAAG;AACjD,sBAAM,mDAAmB,EAAE,YAAY,KAAK,CAAC;AAC7C;AAAA,UACJ;AAEA;AAAA,QACJ;AACA,gBAAI,2DAA2B,OAAO,EAAE,GAAG;AACvC,gBAAM,aAAa,GAAG,MAAM,GAAG,EAAE,CAAC;AAClC,gBAAM,QAAQ,8BAAY,MAAM,UAAU;AAC1C,gBAAM,MAAM,iBAAiB;AAAA,QACjC;AAAA,MACJ,SAAS,GAAG;AACR,wCAAY,wBAAwB,GAAG,UAAU;AAAA,MACrD;AAAA,IACJ,CAAC;AAED,SAAK,uBAAuB,aAAAA,QAAM,wBAAwB;AAAA,EAC9D;AAAA,EAEA,MAAM,SAAS,UAAqC;AAChD,QAAI;AACA,WAAK,IAAI,KAAK,oBAAoB;AAElC,gBAAM,gCAAY,EAAE,OAAO,KAAK,CAAC;AAEjC,WAAK,aAAa,SAAS;AAC3B,WAAK,aAAa,eAAe;AAEjC,WAAK,cAAc,aAAAA,QAAM,QAAQ;AAEjC,iBAAW,WAAW,8BAAY,UAAU;AACxC,aAAK,cAAc,8BAAY,SAAS,OAA4C,CAAC;AAAA,MACzF;AAEA,WAAK,IAAI,MAAM,iCAAiC;AAEhD,eAAS;AAAA,IACb,SAAS,GAAG;AACR,sCAAY,qBAAqB,GAAG,UAAU;AAC9C,eAAS;AAAA,IACb;AAAA,EACJ;AACJ;AAEA,IAAI;AACJ,IAAI,QAAQ,SAAS,QAAQ;AACzB,YAAU,CAAC,YAAsE,IAAI,cAAc,OAAO;AAC9G,OAAO;AACH,GAAC,MAAM,IAAI,cAAc,GAAG;AAChC;",
  "names": ["store"]
}
