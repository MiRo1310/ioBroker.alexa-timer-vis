{
  "version": 3,
  "sources": ["../../src/lib/start-timer.ts"],
  "sourcesContent": ["import type { TimerIndex } from '../types/types';\nimport { timerObject } from '../config/timer-data';\nimport { useStore } from '../store/store';\nimport { isString, timeToString } from './global';\nimport { interval } from './interval';\nimport type AlexaTimerVis from '../main';\nimport { errorLogger } from './logging';\n\nconst isMoreThanAMinute = (sec: number): boolean => sec > 60;\n\nexport const startTimer = async (sec: number, name: string, inputString: string): Promise<void> => {\n    const store = useStore();\n    const _this = store._this;\n    try {\n        const timerIndex = getAvailableTimerIndex(_this);\n        if (!timerIndex) {\n            return;\n        }\n        const alexaJson = await getAlexaParsedAlexaJson(_this);\n        if (!alexaJson) {\n            return;\n        }\n        const creationTime = alexaJson.creationTime;\n        const startTimeString = timeToString(creationTime);\n        const timerMilliseconds = sec * 1000;\n        const endTimeNumber = creationTime + timerMilliseconds;\n        const endTimeString = timeToString(endTimeNumber);\n        const timer = timerObject.timer[timerIndex];\n        await timer.init();\n        timer.setStartAndEndTime({ creationTime, startTimeString, endTimeNumber, endTimeString });\n\n        await timer.setIdFromEcoDeviceTimerList();\n\n        if (isMoreThanAMinute(sec)) {\n            interval(sec, timerIndex, inputString, name, timer, store.intervalMore60 * 1000, false);\n            return;\n        }\n\n        timerObject.timer[timerIndex].setInterval(store.intervalLess60 * 1000);\n\n        interval(sec, timerIndex, inputString, name, timer, store.intervalLess60 * 1000, true);\n    } catch (e: any) {\n        errorLogger('Error in startTimer', e, _this);\n    }\n};\n\nexport interface AlexaJson {\n    name: string;\n    serialNumber: string;\n    summary: string;\n    creationTime: number;\n    domainApplicationId: string;\n    domainApplicationName: string;\n    cardContent: string;\n    card: string;\n    answerText: string;\n    utteranceType: string;\n    domain: string;\n    intent: string;\n}\n\nexport async function getAlexaParsedAlexaJson(alexaTimerVis: AlexaTimerVis): Promise<AlexaJson | undefined> {\n    const instance = useStore().getAlexaInstanceObject().instance;\n    const jsonAlexa = await alexaTimerVis.getForeignStateAsync(`alexa2.${instance}.History.json`);\n    try {\n        if (isString(jsonAlexa?.val)) {\n            return JSON.parse(jsonAlexa.val);\n        }\n    } catch {\n        return;\n    }\n}\n\nfunction getAvailableTimerIndex(_this: AlexaTimerVis): TimerIndex | undefined {\n    for (let i = 0; i < Object.keys(timerObject.timerActive.timer).length; i++) {\n        const key = Object.keys(timerObject.timerActive.timer)[i];\n\n        if (!timerObject.timerActive.timer[key]) {\n            timerObject.timerActive.timer[key] = true;\n            return key;\n        }\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,wBAA4B;AAC5B,mBAAyB;AACzB,oBAAuC;AACvC,sBAAyB;AAEzB,qBAA4B;AAE5B,MAAM,oBAAoB,CAAC,QAAyB,MAAM;AAEnD,MAAM,aAAa,OAAO,KAAa,MAAc,gBAAuC;AAC/F,QAAM,YAAQ,uBAAS;AACvB,QAAM,QAAQ,MAAM;AACpB,MAAI;AACA,UAAM,aAAa,uBAAuB,KAAK;AAC/C,QAAI,CAAC,YAAY;AACb;AAAA,IACJ;AACA,UAAM,YAAY,MAAM,wBAAwB,KAAK;AACrD,QAAI,CAAC,WAAW;AACZ;AAAA,IACJ;AACA,UAAM,eAAe,UAAU;AAC/B,UAAM,sBAAkB,4BAAa,YAAY;AACjD,UAAM,oBAAoB,MAAM;AAChC,UAAM,gBAAgB,eAAe;AACrC,UAAM,oBAAgB,4BAAa,aAAa;AAChD,UAAM,QAAQ,8BAAY,MAAM,UAAU;AAC1C,UAAM,MAAM,KAAK;AACjB,UAAM,mBAAmB,EAAE,cAAc,iBAAiB,eAAe,cAAc,CAAC;AAExF,UAAM,MAAM,4BAA4B;AAExC,QAAI,kBAAkB,GAAG,GAAG;AACxB,oCAAS,KAAK,YAAY,aAAa,MAAM,OAAO,MAAM,iBAAiB,KAAM,KAAK;AACtF;AAAA,IACJ;AAEA,kCAAY,MAAM,UAAU,EAAE,YAAY,MAAM,iBAAiB,GAAI;AAErE,kCAAS,KAAK,YAAY,aAAa,MAAM,OAAO,MAAM,iBAAiB,KAAM,IAAI;AAAA,EACzF,SAAS,GAAQ;AACb,oCAAY,uBAAuB,GAAG,KAAK;AAAA,EAC/C;AACJ;AAiBA,eAAsB,wBAAwB,eAA8D;AACxG,QAAM,eAAW,uBAAS,EAAE,uBAAuB,EAAE;AACrD,QAAM,YAAY,MAAM,cAAc,qBAAqB,UAAU,QAAQ,eAAe;AAC5F,MAAI;AACA,YAAI,wBAAS,uCAAW,GAAG,GAAG;AAC1B,aAAO,KAAK,MAAM,UAAU,GAAG;AAAA,IACnC;AAAA,EACJ,QAAQ;AACJ;AAAA,EACJ;AACJ;AAEA,SAAS,uBAAuB,OAA8C;AAC1E,WAAS,IAAI,GAAG,IAAI,OAAO,KAAK,8BAAY,YAAY,KAAK,EAAE,QAAQ,KAAK;AACxE,UAAM,MAAM,OAAO,KAAK,8BAAY,YAAY,KAAK,EAAE,CAAC;AAExD,QAAI,CAAC,8BAAY,YAAY,MAAM,GAAG,GAAG;AACrC,oCAAY,YAAY,MAAM,GAAG,IAAI;AACrC,aAAO;AAAA,IACX;AAAA,EACJ;AACJ;",
  "names": []
}
