{
  "version": 3,
  "sources": ["../../src/lib/start-timer.ts"],
  "sourcesContent": ["import type { TimerIndex } from '@/types/types';\nimport { timerObject } from '@/config/timer-data';\nimport store from '@/store/store';\nimport { isString, timeToString } from '@/lib/global';\nimport { interval } from '@/lib/interval';\nimport { errorLogger } from '@/lib/logging';\n\nconst isMoreThanAMinute = (sec: number): boolean => sec > 60;\n\nexport const startTimer = async (sec: number, name: string): Promise<void> => {\n    try {\n        //TODO : Add test\n        const timerIndex = getAvailableTimerIndex();\n\n        if (!timerIndex) {\n            throw new Error('TimerIndex was not found');\n        }\n        const alexaJson = await getAlexaParsedAlexaJson();\n        if (!alexaJson) {\n            return;\n        }\n        const creationTime = alexaJson.creationTime;\n        const startTimeString = timeToString(creationTime);\n        const timerMilliseconds = sec * 1000;\n        const endTimeNumber = creationTime + timerMilliseconds;\n        const endTimeString = timeToString(endTimeNumber);\n        const timer = timerObject.timer[timerIndex];\n        await timer.init(timerIndex);\n        //TODO: mit in den init rein packen\n        timer.setStartAndEndTime({ creationTime, startTimeString, endTimeNumber, endTimeString });\n\n        await timer.setIdFromEcoDeviceTimerList();\n\n        if (isMoreThanAMinute(sec)) {\n            interval(sec, name, timer, store.intervalMore60 * 1000, false);\n            return;\n        }\n\n        timerObject.timer[timerIndex].setInterval(store.intervalLess60 * 1000);\n\n        interval(sec, name, timer, store.intervalLess60 * 1000, true);\n    } catch (e: any) {\n        errorLogger('Error in startTimer', e);\n    }\n};\n\nexport interface AlexaJson {\n    name: string;\n    serialNumber: string;\n    summary: string;\n    creationTime: number;\n    domainApplicationId: string;\n    domainApplicationName: string;\n    cardContent: string;\n    card: string;\n    answerText: string;\n    utteranceType: string;\n    domain: string;\n    intent: string;\n}\n\nexport async function getAlexaParsedAlexaJson(): Promise<AlexaJson | undefined> {\n    const instance = store.getAlexaInstanceObject().instance;\n    const jsonAlexa = await store.adapter.getForeignStateAsync(`alexa2.${instance}.History.json`);\n    try {\n        if (isString(jsonAlexa?.val)) {\n            return JSON.parse(jsonAlexa.val);\n        }\n    } catch {\n        return;\n    }\n}\n\nfunction getAvailableTimerIndex(): TimerIndex | undefined {\n    for (let i = 0; i < Object.keys(timerObject.timerActive.timer).length; i++) {\n        const key = Object.keys(timerObject.timerActive.timer)[i];\n\n        if (!timerObject.timerActive.timer[key]) {\n            timerObject.timerActive.timer[key] = true;\n            return key;\n        }\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,wBAA4B;AAC5B,mBAAkB;AAClB,oBAAuC;AACvC,sBAAyB;AACzB,qBAA4B;AAE5B,MAAM,oBAAoB,CAAC,QAAyB,MAAM;AAEnD,MAAM,aAAa,OAAO,KAAa,SAAgC;AAC1E,MAAI;AAEA,UAAM,aAAa,uBAAuB;AAE1C,QAAI,CAAC,YAAY;AACb,YAAM,IAAI,MAAM,0BAA0B;AAAA,IAC9C;AACA,UAAM,YAAY,MAAM,wBAAwB;AAChD,QAAI,CAAC,WAAW;AACZ;AAAA,IACJ;AACA,UAAM,eAAe,UAAU;AAC/B,UAAM,sBAAkB,4BAAa,YAAY;AACjD,UAAM,oBAAoB,MAAM;AAChC,UAAM,gBAAgB,eAAe;AACrC,UAAM,oBAAgB,4BAAa,aAAa;AAChD,UAAM,QAAQ,8BAAY,MAAM,UAAU;AAC1C,UAAM,MAAM,KAAK,UAAU;AAE3B,UAAM,mBAAmB,EAAE,cAAc,iBAAiB,eAAe,cAAc,CAAC;AAExF,UAAM,MAAM,4BAA4B;AAExC,QAAI,kBAAkB,GAAG,GAAG;AACxB,oCAAS,KAAK,MAAM,OAAO,aAAAA,QAAM,iBAAiB,KAAM,KAAK;AAC7D;AAAA,IACJ;AAEA,kCAAY,MAAM,UAAU,EAAE,YAAY,aAAAA,QAAM,iBAAiB,GAAI;AAErE,kCAAS,KAAK,MAAM,OAAO,aAAAA,QAAM,iBAAiB,KAAM,IAAI;AAAA,EAChE,SAAS,GAAQ;AACb,oCAAY,uBAAuB,CAAC;AAAA,EACxC;AACJ;AAiBA,eAAsB,0BAA0D;AAC5E,QAAM,WAAW,aAAAA,QAAM,uBAAuB,EAAE;AAChD,QAAM,YAAY,MAAM,aAAAA,QAAM,QAAQ,qBAAqB,UAAU,QAAQ,eAAe;AAC5F,MAAI;AACA,YAAI,wBAAS,uCAAW,GAAG,GAAG;AAC1B,aAAO,KAAK,MAAM,UAAU,GAAG;AAAA,IACnC;AAAA,EACJ,QAAQ;AACJ;AAAA,EACJ;AACJ;AAEA,SAAS,yBAAiD;AACtD,WAAS,IAAI,GAAG,IAAI,OAAO,KAAK,8BAAY,YAAY,KAAK,EAAE,QAAQ,KAAK;AACxE,UAAM,MAAM,OAAO,KAAK,8BAAY,YAAY,KAAK,EAAE,CAAC;AAExD,QAAI,CAAC,8BAAY,YAAY,MAAM,GAAG,GAAG;AACrC,oCAAY,YAAY,MAAM,GAAG,IAAI;AACrC,aAAO;AAAA,IACX;AAAA,EACJ;AACJ;",
  "names": ["store"]
}
