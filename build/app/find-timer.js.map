{
  "version": 3,
  "sources": ["../../src/app/find-timer.ts"],
  "sourcesContent": ["import store from '@/store/store';\nimport { timerObject } from '@/config/timer-data';\nimport type { OneOfMultiTimer, TimerIndex } from '@/types/types';\nimport errorLogger from '@/lib/logging';\nimport type { Timer } from '@/app/timer';\nimport { isIobrokerValue } from '@/lib/state';\nimport { isString } from '@/lib/string';\nimport type { VoiceInput } from '@/app/voiceInput';\n\nexport const findTimer = async (\n    sec: number,\n    name: string,\n    deleteTimerIndex: number,\n    voiceInput: VoiceInput,\n): Promise<{ oneOfMultiTimer: OneOfMultiTimer; timer: TimerIndex[] }> => {\n    const adapter = store.adapter;\n    try {\n        name = name.trim();\n        let inputDevice = '';\n\n        const obj = await adapter.getForeignStateAsync(\n            `alexa2.${store.getAlexaInstanceObject().instance}.History.name`,\n        );\n\n        if (isIobrokerValue(obj) && isString(obj.val)) {\n            inputDevice = obj.val;\n        }\n\n        const { matchingTime, matchingName, matchingInputDevice } = getMatchingTimerCounts(inputDevice, sec, name);\n\n        const timerFound: {\n            oneOfMultiTimer: OneOfMultiTimer;\n            timer: TimerIndex[];\n        } = { oneOfMultiTimer: {} as OneOfMultiTimer, timer: [] };\n\n        if (store.questionAlexa) {\n            if (matchingName == 1) {\n                timerFound.oneOfMultiTimer = { sec: 0, name, inputDevice };\n            } else if (matchingTime > 1) {\n                // Einer, mit genauer Zeit, mehrmals vorhanden\n                timerFound.oneOfMultiTimer = { sec, name: '', inputDevice: '' };\n            } else if (matchingInputDevice != timerObject.timerActive.timerCount) {\n                // Einer, mit genauer Zeit, mehrmals auf verschiedenen Ger\u00E4ten\n\n                timerFound.oneOfMultiTimer = { sec, name: '', inputDevice: '' };\n            } else {\n                timerFound.oneOfMultiTimer = { sec: 0, name: '', inputDevice: '' };\n            }\n        }\n\n        for (const timerIndex in timerObject.timer) {\n            // Soll einer oder mehrere Timer gel\u00F6scht werden?\n            if (deleteTimerIndex == 1) {\n                // Einer, mit genauer Zeit, nur einmal vorhanden\n                // Einer, und einer ist auch nur gestellt\n                if (!store.questionAlexa) {\n                    const voiceInputAsSeconds = timerObject.timer[timerIndex].getVoiceInputAsSeconds();\n                    if (timerObject.timerActive.timerCount == 1 && timerObject.timerActive.timer[timerIndex]) {\n                        timerFound.timer.push(timerIndex);\n                        // _this.log.debug(\"Einer, wenn genau einer gestellt ist\");\n                    } else if (matchingTime == 1 && voiceInputAsSeconds == sec && sec !== 0) {\n                        timerFound.timer.push(timerIndex);\n                    } else if (\n                        // _this.log.debug(\"Wenn nur einer gestellt ist mit der der gew\u00FCnschten Zeit\");\n                        matchingTime == 1 &&\n                        voiceInputAsSeconds == sec\n                    ) {\n                        timerFound.timer.push(timerIndex);\n                        // _this.log.debug(\"Einer ist gestellt mit genau diesem Wert\");\n                    } else if (\n                        // Einer, mit genauem Namen\n                        timerObject.timer[timerIndex].getName() == name &&\n                        name !== '' &&\n                        matchingName == 1\n                    ) {\n                        timerFound.timer.push(timerIndex);\n                    }\n                }\n            } else if (deleteTimerIndex == 2) {\n                // Alle, alle sind auf einem Ger\u00E4t\n                if (!store.questionAlexa) {\n                    timerFound.timer.push(timerIndex);\n                    // }\n                } else {\n                    // Alle, nur die vom eingabe Ger\u00E4t\n                    if (\n                        matchingInputDevice != timerObject.timerActive.timerCount &&\n                        voiceInput.getIndexOf('nein') != -1\n                    ) {\n                        if (timerObject.timer[timerIndex].getInputDevice() == inputDevice) {\n                            timerFound.timer.push(timerIndex);\n                            // _this.log.debug(\"Only this device\");\n                        }\n                    } else if (\n                        // Alle, von allen Ger\u00E4ten\n                        matchingInputDevice != timerObject.timerActive.timerCount &&\n                        voiceInput.getIndexOf('ja') != -1\n                    ) {\n                        for (const element in timerObject.timerActive.timer) {\n                            timerFound.timer.push(element);\n                            adapter.log.debug('Clear all');\n                        }\n                    }\n                }\n            }\n        }\n        return timerFound;\n    } catch (e) {\n        errorLogger.send({\n            title: 'Error in findTimer',\n            e,\n            additionalInfos: [['VoiceInput', voiceInput.get()]],\n        });\n\n        return { oneOfMultiTimer: {} as OneOfMultiTimer, timer: [] };\n    }\n};\n\nfunction isSameInputDevice(timer: Timer, inputDevice: string): boolean {\n    return timer.getInputDevice() === inputDevice;\n}\n\nfunction isSameName(timer: Timer, name: string): boolean {\n    return timer.getName() == name;\n}\n\nfunction isSameSec(timer: Timer, sec: number): boolean {\n    return timer.getVoiceInputAsSeconds() == sec;\n}\n\nfunction getMatchingTimerCounts(\n    inputDevice: string,\n    sec: number,\n    name: string,\n): { matchingName: number; matchingTime: number; matchingInputDevice: number } {\n    let matchingTime = 0;\n    let matchingName = 0;\n    let matchingInputDevice = 0;\n\n    for (const el in timerObject.timer) {\n        const timer = timerObject.timer[el];\n\n        matchingTime = isSameSec(timer, sec) ? matchingTime + 1 : matchingTime;\n        matchingName = isSameName(timer, name) ? matchingName + 1 : matchingName;\n        matchingInputDevice = isSameInputDevice(timer, inputDevice) ? matchingInputDevice + 1 : matchingInputDevice;\n    }\n    return {\n        matchingName,\n        matchingTime,\n        matchingInputDevice,\n    };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAClB,wBAA4B;AAE5B,qBAAwB;AAExB,mBAAgC;AAChC,oBAAyB;AAGlB,MAAM,YAAY,OACrB,KACA,MACA,kBACA,eACqE;AACrE,QAAM,UAAU,aAAAA,QAAM;AACtB,MAAI;AACA,WAAO,KAAK,KAAK;AACjB,QAAI,cAAc;AAElB,UAAM,MAAM,MAAM,QAAQ;AAAA,MACtB,UAAU,aAAAA,QAAM,uBAAuB,EAAE,QAAQ;AAAA,IACrD;AAEA,YAAI,8BAAgB,GAAG,SAAK,wBAAS,IAAI,GAAG,GAAG;AAC3C,oBAAc,IAAI;AAAA,IACtB;AAEA,UAAM,EAAE,cAAc,cAAc,oBAAoB,IAAI,uBAAuB,aAAa,KAAK,IAAI;AAEzG,UAAM,aAGF,EAAE,iBAAiB,CAAC,GAAsB,OAAO,CAAC,EAAE;AAExD,QAAI,aAAAA,QAAM,eAAe;AACrB,UAAI,gBAAgB,GAAG;AACnB,mBAAW,kBAAkB,EAAE,KAAK,GAAG,MAAM,YAAY;AAAA,MAC7D,WAAW,eAAe,GAAG;AAEzB,mBAAW,kBAAkB,EAAE,KAAK,MAAM,IAAI,aAAa,GAAG;AAAA,MAClE,WAAW,uBAAuB,8BAAY,YAAY,YAAY;AAGlE,mBAAW,kBAAkB,EAAE,KAAK,MAAM,IAAI,aAAa,GAAG;AAAA,MAClE,OAAO;AACH,mBAAW,kBAAkB,EAAE,KAAK,GAAG,MAAM,IAAI,aAAa,GAAG;AAAA,MACrE;AAAA,IACJ;AAEA,eAAW,cAAc,8BAAY,OAAO;AAExC,UAAI,oBAAoB,GAAG;AAGvB,YAAI,CAAC,aAAAA,QAAM,eAAe;AACtB,gBAAM,sBAAsB,8BAAY,MAAM,UAAU,EAAE,uBAAuB;AACjF,cAAI,8BAAY,YAAY,cAAc,KAAK,8BAAY,YAAY,MAAM,UAAU,GAAG;AACtF,uBAAW,MAAM,KAAK,UAAU;AAAA,UAEpC,WAAW,gBAAgB,KAAK,uBAAuB,OAAO,QAAQ,GAAG;AACrE,uBAAW,MAAM,KAAK,UAAU;AAAA,UACpC;AAAA;AAAA,YAEI,gBAAgB,KAChB,uBAAuB;AAAA,YACzB;AACE,uBAAW,MAAM,KAAK,UAAU;AAAA,UAEpC;AAAA;AAAA,YAEI,8BAAY,MAAM,UAAU,EAAE,QAAQ,KAAK,QAC3C,SAAS,MACT,gBAAgB;AAAA,YAClB;AACE,uBAAW,MAAM,KAAK,UAAU;AAAA,UACpC;AAAA,QACJ;AAAA,MACJ,WAAW,oBAAoB,GAAG;AAE9B,YAAI,CAAC,aAAAA,QAAM,eAAe;AACtB,qBAAW,MAAM,KAAK,UAAU;AAAA,QAEpC,OAAO;AAEH,cACI,uBAAuB,8BAAY,YAAY,cAC/C,WAAW,WAAW,MAAM,KAAK,IACnC;AACE,gBAAI,8BAAY,MAAM,UAAU,EAAE,eAAe,KAAK,aAAa;AAC/D,yBAAW,MAAM,KAAK,UAAU;AAAA,YAEpC;AAAA,UACJ;AAAA;AAAA,YAEI,uBAAuB,8BAAY,YAAY,cAC/C,WAAW,WAAW,IAAI,KAAK;AAAA,YACjC;AACE,uBAAW,WAAW,8BAAY,YAAY,OAAO;AACjD,yBAAW,MAAM,KAAK,OAAO;AAC7B,sBAAQ,IAAI,MAAM,WAAW;AAAA,YACjC;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AACA,WAAO;AAAA,EACX,SAAS,GAAG;AACR,mBAAAC,QAAY,KAAK;AAAA,MACb,OAAO;AAAA,MACP;AAAA,MACA,iBAAiB,CAAC,CAAC,cAAc,WAAW,IAAI,CAAC,CAAC;AAAA,IACtD,CAAC;AAED,WAAO,EAAE,iBAAiB,CAAC,GAAsB,OAAO,CAAC,EAAE;AAAA,EAC/D;AACJ;AAEA,SAAS,kBAAkB,OAAc,aAA8B;AACnE,SAAO,MAAM,eAAe,MAAM;AACtC;AAEA,SAAS,WAAW,OAAc,MAAuB;AACrD,SAAO,MAAM,QAAQ,KAAK;AAC9B;AAEA,SAAS,UAAU,OAAc,KAAsB;AACnD,SAAO,MAAM,uBAAuB,KAAK;AAC7C;AAEA,SAAS,uBACL,aACA,KACA,MAC2E;AAC3E,MAAI,eAAe;AACnB,MAAI,eAAe;AACnB,MAAI,sBAAsB;AAE1B,aAAW,MAAM,8BAAY,OAAO;AAChC,UAAM,QAAQ,8BAAY,MAAM,EAAE;AAElC,mBAAe,UAAU,OAAO,GAAG,IAAI,eAAe,IAAI;AAC1D,mBAAe,WAAW,OAAO,IAAI,IAAI,eAAe,IAAI;AAC5D,0BAAsB,kBAAkB,OAAO,WAAW,IAAI,sBAAsB,IAAI;AAAA,EAC5F;AACA,SAAO;AAAA,IACH;AAAA,IACA;AAAA,IACA;AAAA,EACJ;AACJ;",
  "names": ["store", "errorLogger"]
}
